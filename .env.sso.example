# SSO Configuration Example for LibreChat
# Copy this file to .env and configure your SSO settings

#=====================================================================#
#                   Server Configuration                              #
#=====================================================================#

HOST=localhost
PORT=3080

# MongoDB Connection
MONGO_URI=mongodb://127.0.0.1:27017/LibreChat

# Domain Configuration (Important for SSO redirect URIs)
DOMAIN_CLIENT=http://localhost:3080
DOMAIN_SERVER=http://localhost:3080

#=====================================================================#
#                   OpenID Connect (SSO) Configuration                #
#=====================================================================#

# Required: OpenID Connect Provider Settings
OPENID_CLIENT_ID=your-client-id-here
OPENID_CLIENT_SECRET=your-client-secret-here
OPENID_ISSUER=https://your-identity-provider.com/realms/your-realm
OPENID_SESSION_SECRET=generate-secure-random-string-minimum-32-characters
OPENID_SCOPE="openid profile email"
OPENID_CALLBACK_URL=/oauth/openid/callback

# Optional: Customize SSO Button
OPENID_BUTTON_LABEL="Sign in with SSO"
OPENID_IMAGE_URL=https://your-identity-provider.com/logo.png

# Optional: Auto-redirect to SSO (bypasses login form)
# Set to true if SSO is your only authentication method
OPENID_AUTO_REDIRECT=false

# Optional: Use PKCE for enhanced security (recommended)
OPENID_USE_PKCE=true

# Optional: Audience parameter (required for some providers like Auth0)
# OPENID_AUDIENCE=your-audience-id

# Optional: Generate nonce for federated providers
# OPENID_GENERATE_NONCE=false

#=====================================================================#
#            Role-Based Access Control (Optional)                     #
#=====================================================================#

# Require specific role(s) to access LibreChat (comma-separated)
# OPENID_REQUIRED_ROLE=librechat-user,librechat-admin
# OPENID_REQUIRED_ROLE_TOKEN_KIND=access
# OPENID_REQUIRED_ROLE_PARAMETER_PATH=resource_access.librechat.roles

# Admin role configuration
# Users with this role will have admin privileges in LibreChat
# OPENID_ADMIN_ROLE=librechat-admin
# OPENID_ADMIN_ROLE_PARAMETER_PATH=resource_access.librechat.roles
# OPENID_ADMIN_ROLE_TOKEN_KIND=access

#=====================================================================#
#              Custom Claims Mapping (Optional)                       #
#=====================================================================#

# Map identity provider claims to LibreChat user fields
# OPENID_USERNAME_CLAIM=preferred_username
# OPENID_NAME_CLAIM=name

#=====================================================================#
#              Token Management (Optional)                            #
#=====================================================================#

# Reuse OpenID tokens for authentication (reduces IDP load)
# OPENID_REUSE_TOKENS=false

# Enable JWKS URL caching
# OPENID_JWKS_URL_CACHE_ENABLED=true
# OPENID_JWKS_URL_CACHE_TIME=600000

# On-behalf-of flow for Microsoft Graph API
# Required if using Azure AD and need to access Microsoft Graph
# OPENID_ON_BEHALF_FLOW_FOR_USERINFO_REQUIRED=false
# OPENID_ON_BEHALF_FLOW_USERINFO_SCOPE="user.read"

# Use OpenID Connect end session endpoint for logout
# OPENID_USE_END_SESSION_ENDPOINT=false

# Clock tolerance for token validation (in seconds)
# OPENID_CLOCK_TOLERANCE=300

#=====================================================================#
#              Authentication Control                                 #
#=====================================================================#

# Control which authentication methods are available
ALLOW_EMAIL_LOGIN=true
ALLOW_REGISTRATION=false
ALLOW_SOCIAL_LOGIN=true
ALLOW_SOCIAL_REGISTRATION=false

#=====================================================================#
#              JWT Configuration                                      #
#=====================================================================#

# Generate secure random strings for these (minimum 32 characters)
JWT_SECRET=generate-secure-random-string-minimum-32-characters
JWT_REFRESH_SECRET=generate-secure-random-string-minimum-32-characters

# Session expiration (15 minutes)
SESSION_EXPIRY=1000 * 60 * 15

# Refresh token expiration (7 days)
REFRESH_TOKEN_EXPIRY=(1000 * 60 * 60 * 24) * 7

#=====================================================================#
#              Debugging (Development Only)                           #
#=====================================================================#

# Enable detailed logging for OpenID Connect
DEBUG_LOGGING=true
DEBUG_OPENID_REQUESTS=false

# Console logging
DEBUG_CONSOLE=false
CONSOLE_JSON=false

#=====================================================================#
#              Additional Services Configuration                      #
#=====================================================================#

# Meilisearch (for conversation search)
SEARCH=true
MEILI_HOST=http://0.0.0.0:7700
MEILI_MASTER_KEY=DrhYf7zENyR6AlUCKmnz0eYASOQdl6zxH7s7MKFSfFCt
MEILI_NO_ANALYTICS=true

#=====================================================================#
#              Redis Configuration (Optional)                         #
#=====================================================================#

# Enable Redis for caching and session storage (recommended for production)
# USE_REDIS=true
# REDIS_URI=redis://127.0.0.1:6379

# Redis authentication (if required)
# REDIS_USERNAME=your_redis_username
# REDIS_PASSWORD=your_redis_password

#=====================================================================#
#              Proxy Configuration (If Needed)                        #
#=====================================================================#

# HTTP/HTTPS proxy for outbound requests
# PROXY=http://your-proxy:port

# Trust proxy headers (set to 1 if behind reverse proxy)
TRUST_PROXY=1

#=====================================================================#
#              Notes                                                  #
#=====================================================================#

# 1. Generate secure random strings using:
#    node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# 2. Ensure DOMAIN_SERVER + OPENID_CALLBACK_URL is configured as a
#    valid redirect URI in your identity provider
#
# 3. For production, use HTTPS and proper domain names
#
# 4. Test your configuration thoroughly before deploying to production
#
# 5. See docs/SSO_CONFIGURATION.md for detailed documentation
